!function(e){var t={};function i(n){if(t[n])return t[n].exports;var l=t[n]={i:n,l:!1,exports:{}};return e[n].call(l.exports,l,l.exports,i),l.l=!0,l.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)i.d(n,l,function(t){return e[t]}.bind(null,l));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/build/",i(i.s=0)}([function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.r(t);var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),l(this,"score",0),l(this,"lines",0),l(this,"topOut",!1),l(this,"playfield",this.createPlayField()),l(this,"activePiece",this.createPiece()),l(this,"nextPiece",this.createPiece())}var t,i,s;return t=e,(i=[{key:"getState",value:function(){for(var e=this.createPlayField(),t=this.activePiece,i=t.y,n=t.x,l=t.blocks,s=0;s<this.playfield.length;s++){e[s]=[];for(var a=0;a<this.playfield[s].length;a++)e[s][a]=this.playfield[s][a]}for(var r=0;r<l.length;r++)for(var h=0;h<l[r].length;h++)l[r][h]&&(e[i+r][n+h]=l[r][h]);return{score:this.score,level:this.level,lines:this.lines,nextPiece:this.nextPiece,playfield:e,isGameOver:this.topOut}}},{key:"createPlayField",value:function(){for(var e=[],t=0;t<20;t++){e[t]=[];for(var i=0;i<10;i++)e[t][i]=0}return e}},{key:"createPiece",value:function(){var e={};switch("IJLOSTZ"[Math.floor(7*Math.random())]){case"I":e.blocks=[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]];break;case"J":e.blocks=[[0,0,0],[2,2,2],[0,0,2]];break;case"L":e.blocks=[[0,0,0],[3,3,3],[3,0,0]];break;case"O":e.blocks=[[0,0,0,0],[0,4,4,0],[0,4,4,0],[0,0,0,0]];break;case"S":e.blocks=[[0,0,0],[0,5,5],[5,5,0]];break;case"T":e.blocks=[[0,0,0],[6,6,6],[0,6,0]];break;case"Z":e.blocks=[[0,0,0],[7,7,0],[0,7,7]];break;default:throw new Error("Not found")}return e.x=Math.floor((10-e.blocks[0].length)/2),e.y=-1,e}},{key:"movePieceLeft",value:function(){this.activePiece.x-=1,this.hasCollision()&&(this.activePiece.x+=1)}},{key:"movePieceRight",value:function(){this.activePiece.x+=1,this.hasCollision()&&(this.activePiece.x-=1)}},{key:"movePieceDown",value:function(){if(!this.topOut){if(this.activePiece.y+=1,this.hasCollision()){this.activePiece.y-=1,this.lockPiece();var e=this.clearLines();this.updateScore(e),this.updatePieces()}this.hasCollision()&&(this.topOut=!0)}}},{key:"rotatePiece",value:function(){for(var e=this.activePiece.blocks,t=e.length,i=[],n=0;n<t;n++)i[n]=new Array(t).fill(0);for(var l=0;l<t;l++)for(var s=0;s<t;s++)i[s][l]=e[t-1-l][s];this.activePiece.blocks=i,this.hasCollision()&&(this.activePiece.blocks=e)}},{key:"hasCollision",value:function(){for(var e=this.activePiece,t=e.y,i=e.x,n=e.blocks,l=0;l<n.length;l++)for(var s=0;s<n[l].length;s++)if(n[l][s]&&(void 0===this.playfield[t+l]||void 0===this.playfield[t+l][i+s]||this.playfield[t+l][i+s]))return!0}},{key:"lockPiece",value:function(){for(var e=this.activePiece,t=this.activePiece.blocks,i=0;i<t.length;i++)for(var n=0;n<t[i].length;n++)t[i][n]&&(this.playfield[e.y+i][e.x+n]=e.blocks[i][n])}},{key:"clearLines",value:function(){for(var e=[],t=19;t>=0;t--){for(var i=0,n=0;n<10;n++)this.playfield[t][n]&&(i+=1);if(0===i)break;i<10||10===i&&e.unshift(t)}for(var l=0,s=e;l<s.length;l++){var a=s[l];this.playfield.splice(a,1),this.playfield.unshift(new Array(10).fill(0))}return e.length}},{key:"updateScore",value:function(t){t>0&&(this.score+=e.points[t]*(this.level+1),this.lines+=t)}},{key:"updatePieces",value:function(){this.activePiece=this.nextPiece,this.nextPiece=this.createPiece()}},{key:"level",get:function(){return Math.floor(.1*this.lines)}}])&&n(t.prototype,i),s&&n(t,s),e}();function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}l(s,"points",{1:40,2:80,3:160,4:320,5:640});var r,h,o,c=function(){function e(t,i,n,l,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.width=i,this.height=n,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.playFieledBorderWidth=4,this.playfieldX=this.playFieledBorderWidth,this.playfieldY=this.playFieledBorderWidth,this.playfieldWidth=2*this.width/3,this.playfieldHeight=this.height,this.playfieldInnerWidth=this.playfieldWidth-2*this.playFieledBorderWidth,this.playfieldInnerHeigth=this.playfieldHeight-2*this.playFieledBorderWidth,this.blockWidth=this.playfieldInnerWidth/s,this.blockHeigth=this.playfieldInnerHeigth/l,this.panelX=this.playfieldWidth+10,this.panelY=0,this.panelWidth=this.width/3,this.panelHeigth=this.height,this.element.appendChild(this.canvas)}var t,i,n;return t=e,(i=[{key:"renderMainScreen",value:function(e){this.clearScreen(),this.renderPlayField(e),this.renderPanel(e)}},{key:"renderStartScreen",value:function(){this.context.fillStyle="white",this.context.font='18px "Time New Roman"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("Press ENTER to start",this.width/2,this.height/2),this.context.fillText("PC version",this.width/2,this.height/2+48)}},{key:"renderPauseScreen",value:function(){this.context.fillStyle="rgba(0,0,0,0.75)",this.context.fillRect(0,0,this.width,this.height),this.context.fillStyle="white",this.context.font='18px "Time New Roman"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("Press ENTER to start",this.width/2,this.height/2)}},{key:"renderEndScreen",value:function(e){var t=e.score;this.clearScreen(),this.context.fillStyle="white",this.context.font='18px "Time New Roman"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("Game Over",this.width/2,this.height/2-48),this.context.fillText("Score: ".concat(t),this.width/2,this.height/2),this.context.fillText("Press F5 to continue",this.width/2,this.height/2+48)}},{key:"clearScreen",value:function(){this.context.clearRect(0,0,this.width,this.height)}},{key:"renderPlayField",value:function(t){for(var i=t.playfield,n=0;n<i.length;n++)for(var l=i[n],s=0;s<l.length;s++){var a=l[s];a&&this.renderBlock(this.playfieldX+s*this.blockWidth,this.playfieldY+n*this.blockHeigth,this.blockWidth,this.blockHeigth,e.colors[a])}this.context.strokeStyle="white",this.context.lineWidth=this.playFieledBorderWidth,this.context.strokeRect(0,0,this.playfieldWidth,this.playfieldHeight)}},{key:"renderPanel",value:function(t){var i=t.level,n=t.score,l=t.lines,s=t.nextPiece;this.context.textAlign="start",this.context.textBaseline="top",this.context.fillStyle="white",this.context.font='18px "Time New Roman"',this.context.fillText("Score: ".concat(n),this.panelX,this.panelY+0),this.context.fillText("Lines: ".concat(l),this.panelX,this.panelY+24),this.context.fillText("Level: ".concat(i),this.panelX,this.panelY+48),this.context.fillText("Next",this.panelX,this.panelY+96);for(var a=0;a<s.blocks.length;a++)for(var r=0;r<s.blocks[a].length;r++){var h=s.blocks[a][r];h&&this.renderBlock(this.panelX+r*this.blockWidth*.5,this.panelY+120+a*this.blockHeigth*.5,.5*this.blockWidth,.5*this.blockHeigth,e.colors[h])}}},{key:"renderBlock",value:function(e,t,i,n,l){this.context.fillStyle=l,this.context.strokeStyle="black",this.context.lineWidth=2,this.context.fillRect(e,t,i,n),this.context.strokeRect(e,t,i,n)}}])&&a(t.prototype,i),n&&a(t,n),e}();function f(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}o={1:"cyan",2:"blue",3:"orange",4:"yellow",5:"green",6:"purple",7:"red"},(h="colors")in(r=c)?Object.defineProperty(r,h,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[h]=o;var u=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.view=i,this.intervalId=null,this.isPlaying=!1,document.addEventListener("keydown",this.handleKeyDown.bind(this)),this.view.renderStartScreen()}var t,i,n;return t=e,(i=[{key:"update",value:function(){this.game.movePieceDown(),this.updateView()}},{key:"play",value:function(){this.isPlaying=!0,this.startTimer(),this.updateView()}},{key:"pause",value:function(){this.isPlaying=!1,this.stopTimer(),this.updateView()}},{key:"updateView",value:function(){var e=this.game.getState();e.isGameOver?this.view.renderEndScreen(e):this.isPlaying?this.view.renderMainScreen(e):this.view.renderPauseScreen()}},{key:"startTimer",value:function(){var e=this,t=1e3-100*this.game.getState().level;this.intervalId=setInterval((function(){e.update()}),t>0?t:100)}},{key:"stopTimer",value:function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}},{key:"handleKeyDown",value:function(e){switch(e.keyCode){case 13:this.isPlaying?this.pause():this.play();break;case 37:this.game.movePieceLeft(),this.view.renderMainScreen(this.game.getState());break;case 38:this.game.rotatePiece(),this.view.renderMainScreen(this.game.getState());break;case 39:this.game.movePieceRight(),this.view.renderMainScreen(this.game.getState());break;case 40:this.game.movePieceDown(),this.view.renderMainScreen(this.game.getState())}}}])&&f(t.prototype,i),n&&f(t,n),e}(),d=document.querySelector("#root"),v=new s,y=new c(d,480,640,20,10),p=new u(v,y);window.game=v,window.view=y,window.controller=p}]);